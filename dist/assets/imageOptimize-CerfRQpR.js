import"./site-CkTLYdsb.js";const n={file:document.getElementById("imgOptFile"),maxWidth:document.getElementById("imgOptMaxWidth"),quality:document.getElementById("imgOptQuality"),format:document.getElementById("imgOptFormat"),run:document.getElementById("imgOptRunBtn"),before:document.getElementById("imgOptBefore"),after:document.getElementById("imgOptAfter"),preview:document.getElementById("imgOptPreview"),download:document.getElementById("imgOptDownloadBtn"),message:document.getElementById("imgOptMessage")};let d=null;function l(e,t=!1){n.message.textContent=e,n.message.classList.toggle("message--error",t)}function u(e){return!e&&e!==0?"-":e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(1)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`}function w(e){return new Promise((t,a)=>{const o=new Image,i=URL.createObjectURL(e);o.onload=()=>{URL.revokeObjectURL(i),t(o)},o.onerror=a,o.src=i})}async function B(){var s;const e=(s=n.file.files)==null?void 0:s[0];if(!e){l("이미지를 선택하세요.",!0);return}const t=await w(e),a=Math.max(200,Number(n.maxWidth.value||t.width)),o=Math.min(1,a/t.width),i=Math.round(t.width*o),c=Math.round(t.height*o),m=document.createElement("canvas");m.width=i,m.height=c,m.getContext("2d").drawImage(t,0,0,i,c);const g=n.format.value,f=Math.min(1,Math.max(.2,Number(n.quality.value||.82))),r=await new Promise(h=>m.toBlob(h,g,f));d=r,n.before.value=`${t.width}x${t.height}, ${u(e.size)}`,n.after.value=`${i}x${c}, ${u(r.size)} (${Math.max(0,100-Math.round(r.size/e.size*100))}% 절감)`,n.preview.src=URL.createObjectURL(r),n.preview.hidden=!1,n.download.disabled=!1,l("이미지 최적화 완료.")}n.run.addEventListener("click",()=>B().catch(()=>l("이미지 최적화 실패.",!0)));n.download.addEventListener("click",()=>{if(!d)return;const e=n.format.value.split("/")[1]||"bin",t=document.createElement("a"),a=URL.createObjectURL(d);t.href=a,t.download=`optimized.${e}`,t.click(),URL.revokeObjectURL(a)});
